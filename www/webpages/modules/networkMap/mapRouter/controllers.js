!function(c){c.su.moduleManager.define("mapRouter",{services:["device","ajax"],models:["lanAdvLanModel","wirelessInfoModel","ipv6NetworkMap","performanceM"],stores:["treeStore"],deps:["navigatorController"],views:["mapRouterView"],listeners:{"ev_on_launch":function(e,a,o,t,i,s,r){"RE"===r.device.getCurrentMode().workMode?o.mapRouterView.mapTopology.hide():o.mapRouterView.mapTopology.show(),function n(){t.performanceM.load({success:function(){setTimeout(n,5e3)},fail:function(){setTimeout(n,5e3)},error:function(){setTimeout(n,5e3)}})}(),t.lanAdvLanModel.load(),t.wirelessInfoModel.load(),t.ipv6NetworkMap.load()}},init:function(e,o,i,a,t,s){this.listen({"models.wirelessInfoModel":{"ev_loaded":function(e,a){"ON"===a.guest_enable2_4.toUpperCase()?o.mapRouterView.mapRouterGuest.show():o.mapRouterView.mapRouterGuest.hide()}},"models.ipv6NetworkMap":{"ev_loaded":function(e,a){a.ip&&i.ipv6NetworkMap.ip.show()}}}),this.control({"#map-router-topo":{"ev_item_click":function(e,a,o,t){this.updateDevicePanel(t),this.updateDeviceName(o),i.lanAdvLanModel.load({data:{device_mac:a}}),i.ipv6NetworkMap.load({data:{device_mac:a}})}}})}},function(t,s,e,i,a,o){return{initDecoTree:function(e){var a=e.device_list,o=t.list2Tree(a);i.treeStore.loadData(o)},updateDeviceName:function(e){s.mapRouterView.deviceName.setValue(e)},updateDevicePanel:function(e){s.mapRouterView.mapRouterInfo.setTitle(c.su.CHAR.NETWORK_MAP.ROUTER_INFORMATION+"("+e+")")},setStorage:function(e){var a={PB:c.su.CHAR.UNIT.PB,TB:c.su.CHAR.UNIT.TB,GB:c.su.CHAR.UNIT.GB,MB:c.su.CHAR.UNIT.MB,KB:c.su.CHAR.UNIT.KB,B:c.su.CHAR.UNIT.B};function o(e){return e&&e.toUpperCase()}var t=c.su.capacityToNum(e.storageAvailable+a[o(e.storageAvailableUnit)]),i=c.su.capacityToNum(e.storageCapacity+a[o(e.storageCapacityUnit)]);s.mapRouterView.usbCapacityRate.setValue(t/i*100)},list2Tree:function(e){var a,o,t={},i=c.extend(!0,[],e);e=c.su.filterArrField.call(e,"mac","role","device_model","nickname");for(var s,r=[],n=0;n<e.length;n++)t[(a=e[n]).mac]=n,a.branches=[],a.name=a.device_model,delete a.device_model;for(n=0;n<e.length;n++){switch((s=e[n]).name){case"M1300":case"M5":case"M9Plus":case"P7":o="m5m9plusp7";break;case"M4":case"E4":case"W2400":case"M3":case"E3":case"M4R":case"AC1200":o="M4R";break;case"M3W":o="M3W";break;case"X20":case"X60":o="X20";break;default:o="m5m9plusp7"}s.modelImg=o,"master"!==i[n].role?(u(),e[t[i[n].previous]].branches.push(s)):(u(),r.push(s))}function u(){i[n].online||(s.modelImg=s.modelImg&&s.modelImg+"-offline"||"")}return r}}})}(jQuery);