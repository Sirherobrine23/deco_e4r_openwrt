!function(s){s.su.moduleManager.define("localLogin",{services:["ajax"],models:["localLogin","localLoginControl"],stores:[],views:["localLoginView"],deps:["login","main"],listeners:{"ev_on_launch":function(o,n,e,l,t,r,i){s.encrypt.encryptManager.cleanStorage(),s.su.encryptor=s.encrypt.encryptManager.genEncryptor(),i.ajax.request({proxy:"keyProxy",success:function(o){var e=o;e&&e.password&&(n.encryptKey=e.password)}})}},init:function(e,o,n,l,t,r){this.control({"#local-login-pwd":{"keyup":function(o){13==o.keyCode&&e.doLogin()}},"#local-login-button":{"ev_button_click":function(){e.doLogin()}},".local-login-switch-to-tp":{"click":function(o){t.login.goToChildModule("tpLogin")}},".local-login-forget-pwd":{"click":function(){o.localLoginView.forgetPasswordMsg.show()}}})}},function(n,a,c,o,i,l){return{encryptKey:null,doLogin:function(){var e=c.localLoginControl.password.getValue(),o=c.localLoginControl.password.doEncrypt(n.encryptKey);c.localLogin.password.setValue(o),a.localLoginView.loginBtn.disable(),l.ajax.request({proxy:"authProxy",success:function(o){s.su.encryptor.setRSAKey(o.key[0],o.key[1]),s.su.encryptor.setSeq(o.seq),s.su.encryptor.genAESKey(),s.su.encryptor.setHash("admin",e),s.encrypt.encryptManager.recordEncryptor(),c.localLogin.login({preventFailEvent:!0,success:n.loginSuccessDealer,fail:n.loginFailDealer,error:function(){a.localLoginView.loginBtn.enable()}})},fail:function(){a.localLoginView.loginBtn.enable()},error:function(){a.localLoginView.loginBtn.enable()}})},loginSuccessDealer:function(o,e){var n,l,t,r=o.stok||(n="12345",l=top.location.href,0<=(t=l.indexOf("stok="))&&(n=l.substring(t+5)),n);localStorage&&(i.main.setToken(r),i.main.reload())},loginFailDealer:function(o,e){var n=o.result;switch(a.localLoginView.loginBtn.enable(),e){case-5002:var l,t=n.failureCount,r=n.attemptsAllowed;if(t<7){var i=String(-5002).replace(/^-/,"E");c.localLoginControl.password.setError(s.su.CHAR.ERROR[i])}else l=s.su.CHAR.LOGIN.LOGIN_FAILED_COUNT.replace("%num1",t).replace("%num2",r),a.localLoginView.leftAttemptsMsgContent.setText(l),a.localLoginView.leftAttemptsMsg.show();break;case-5003:a.localLoginView.maxAttemptsMsgContent.setText(s.su.CHAR.ERROR["00000089"]),a.localLoginView.maxAttemptsMsg.show()}},queryRecoveryPasswordMethod:function(){var o=s.Deferred();return o.resolve(!0),o.promise()}}})}(jQuery);